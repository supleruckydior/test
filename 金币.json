-- æœ€ç»ˆå®šåˆ¶ç‰ˆæœ¬ï¼ˆé»‘åº•ç™½å­—çº¢è¾¹ï¼‰
local request = (syn and syn.request) or http_request
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")

-- Discord Webhooké…ç½®
local WEBHOOK_URL = "https://discord.com/api/webhooks/1344800303819784274/RS7UQ8Krgse-n63IZZVA3Q7dCW9if-380cMYpzZNmGR64yyb6chWLJgc0YN7XfXw8C5j"

-- ç³»ç»Ÿæ§åˆ¶å˜é‡
local running = true
local currencyValue = 0
local initialGold = 0
local startTime = os.time()

-- æ•°å€¼æ ¼å¼åŒ–å‡½æ•°
local function formatNumber(num)
    return num >= 1000 and string.format("%.1fk", num/1000) or tostring(math.floor(num))
end

-- é‡‘å¸è·¯å¾„åˆå§‹åŒ–
local function initializeCurrency()
    local success, currencyObj = pcall(function()
        return player:WaitForChild("å€¼"):WaitForChild("è´§å¸"):WaitForChild("é‡‘å¸")
    end)
    
    if success and currencyObj then
        initialGold = currencyObj.Value
        currencyValue = initialGold
        currencyObj:GetPropertyChangedSignal("Value"):Connect(function()
            currencyValue = currencyObj.Value
        end)
        return true
    end
    return false
end

if not initializeCurrency() then return end

-- åˆ›å»ºç›‘æ§ç•Œé¢
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "GoldMonitor_Final"
if syn then syn.protect_gui(screenGui) end
screenGui.Parent = player.PlayerGui

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 320, 0, 220)
mainFrame.Position = UDim2.new(0, 10, 1, -230)  -- å·¦ä¸‹è§’å®šä½
mainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)    -- é»‘åº•
mainFrame.BorderColor3 = Color3.fromRGB(255, 0, 0)     -- çº¢è¾¹
mainFrame.BorderSizePixel = 2
mainFrame.Parent = screenGui

-- ä¿¡æ¯æ˜¾ç¤º
local infoLabel = Instance.new("TextLabel")
infoLabel.Size = UDim2.new(0.9, 0, 0.7, 0)
infoLabel.Position = UDim2.new(0.05, 0, 0.1, 0)
infoLabel.TextColor3 = Color3.fromRGB(255, 255, 255)   -- ç™½å­—
infoLabel.BackgroundTransparency = 1
infoLabel.Font = Enum.Font.SourceSansBold
infoLabel.TextSize = 20
infoLabel.TextXAlignment = Enum.TextXAlignment.Center  -- æ°´å¹³å±…ä¸­
infoLabel.TextYAlignment = Enum.TextYAlignment.Center  -- å‚ç›´å±…ä¸­

-- æ·»åŠ çº¢è‰²æ–‡å­—æè¾¹
local textStroke = Instance.new("UIStroke")
textStroke.Color = Color3.fromRGB(255, 0, 0)  -- çº¢è‰²æè¾¹
textStroke.Thickness = 0.1
textStroke.Parent = infoLabel
infoLabel.Text = "æ­£åœ¨åˆå§‹åŒ–ç›‘æ§ç³»ç»Ÿ..."
infoLabel.Parent = mainFrame

-- æ§åˆ¶æŒ‰é’®ç»„
local buttonContainer = Instance.new("Frame")
buttonContainer.Size = UDim2.new(0.9, 0, 0.2, 0)
buttonContainer.Position = UDim2.new(0.05, 0, 0.82, 0)
buttonContainer.BackgroundTransparency = 1
buttonContainer.Parent = mainFrame

local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0.45, 0, 1, 0)
closeButton.Position = UDim2.new(0.55, 0, 0, 0)
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
closeButton.BorderColor3 = Color3.fromRGB(255, 0, 0)  -- çº¢è‰²è¾¹æ¡†
closeButton.Text = "å…³é—­ç³»ç»Ÿ"
closeButton.Parent = buttonContainer

local reportButton = Instance.new("TextButton")
reportButton.Size = UDim2.new(0.45, 0, 1, 0)
reportButton.Position = UDim2.new(0, 0, 0, 0)
reportButton.TextColor3 = Color3.fromRGB(255, 255, 255)
reportButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
reportButton.BorderColor3 = Color3.fromRGB(255, 0, 0)  -- çº¢è‰²è¾¹æ¡†
reportButton.Text = "å‘é€æŠ¥å‘Š"
reportButton.Parent = buttonContainer

-- Discordæ¶ˆæ¯ç³»ç»Ÿ
local function sendWebhook(content, embed)
    task.spawn(function()
        pcall(function()
            request({
                Url = WEBHOOK_URL,
                Method = "POST",
                Headers = {["Content-Type"] = "application/json"},
                Body = game:GetService("HttpService"):JSONEncode({
                    content = content,
                    embeds = embed and {embed} or nil
                })
            })
        end)
    end)
end

-- ç”ŸæˆæŠ¥å‘Šæ•°æ®
local function generateReport()
    local current = currencyValue
    local elapsed = os.time() - startTime
    local totalEarned = current - initialGold
    local rateMin = elapsed > 0 and (totalEarned / elapsed) * 60 or 0
    local rateHour = rateMin * 60
    
    return {
        title = "ğŸ“Š é‡‘å¸ç›‘æ§æŠ¥å‘Š",
        color = 0x00FF00,
        fields = {
            {name = "ç©å®¶åç§°", value = player.Name},
            {name = "å½“å‰é‡‘é¢", value = formatNumber(current)},
            {name = "åˆ†é’Ÿæ”¶ç›Š", value = formatNumber(rateMin).."/åˆ†"},
            {name = "å°æ—¶æ”¶ç›Š", value = formatNumber(rateHour).."/æ—¶"},
            {name = "è¿è¡Œæ—¶é•¿", value = string.format("%då°æ—¶%dåˆ†", math.floor(elapsed/3600), math.floor((elapsed%3600)/60))},
            {name = "æ€»æ”¶ç›Š", value = formatNumber(totalEarned)}
        }
    }
end

-- å®æ—¶æ•°æ®æ›´æ–°
task.spawn(function()
    local lastUpdate = 0
    
    while running do
        local current = currencyValue
        local elapsed = os.time() - startTime
        local totalEarned = current - initialGold
        
        -- æ›´æ–°ç•Œé¢
        infoLabel.Text = string.format([[å½“å‰é‡‘å¸ï¼š%s
åˆ†é’Ÿæ”¶ç›Šï¼š%s/åˆ†
å°æ—¶æ”¶ç›Šï¼š%s/æ—¶
è¿è¡Œæ—¶é•¿ï¼š%då°æ—¶%dåˆ†
æ€»æ”¶ç›Šï¼š%s]],
            formatNumber(current),
            formatNumber((totalEarned / math.max(elapsed, 1)) * 60),
            formatNumber((totalEarned / math.max(elapsed, 1)) * 3600),
            math.floor(elapsed/3600),
            math.floor((elapsed%3600)/60),
            formatNumber(totalEarned)
        )
        
        -- 3åˆ†é’Ÿè‡ªåŠ¨æŠ¥å‘Š
        if os.time() - lastUpdate >= 180 then
            sendWebhook(nil, generateReport())
            lastUpdate = os.time()
        end
        
        task.wait(0.5)
    end
end)

-- æŒ‰é’®åŠŸèƒ½
reportButton.MouseButton1Click:Connect(function()
    sendWebhook(nil, generateReport())
end)

closeButton.MouseButton1Click:Connect(function()
    running = false
    screenGui:Destroy()
    
    -- æœ€ç»ˆæŠ¥å‘Š
    local elapsed = os.time() - startTime
    sendWebhook("ğŸ”´ ç›‘æ§ç³»ç»Ÿå·²å…³é—­", {
        color = 0xFF0000,
        fields = {
            {name = "æœ€ç»ˆé‡‘é¢", value = formatNumber(currencyValue)},
            {name = "æ€»è¿è¡Œæ—¶é—´", value = string.format("%då°æ—¶%dåˆ†", math.floor(elapsed/3600), math.floor((elapsed%3600)/60))},
            {name = "æ€»æ”¶ç›Š", value = formatNumber(currencyValue - initialGold)}
        }
    })
end)

-- çª—å£æ‹–æ‹½ç³»ç»Ÿ
local dragging = false
local dragStart, startPos

mainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        local newX = math.clamp(startPos.X.Offset + delta.X, 0, workspace.CurrentCamera.ViewportSize.X - mainFrame.AbsoluteSize.X)
        local newY = math.clamp(startPos.Y.Offset + delta.Y, 0, workspace.CurrentCamera.ViewportSize.Y - mainFrame.AbsoluteSize.Y)
        
        mainFrame.Position = UDim2.new(
            0, newX,
            0, newY
        )
    end
end)

-- åˆå§‹åŒ–é€šçŸ¥
sendWebhook(nil, {
    title = "ğŸŸ¢ ç›‘æ§ç³»ç»Ÿå¯åŠ¨",
    color = 0x00FF00,
    fields = {
        {name = "ç©å®¶åç§°", value = player.Name},
        {name = "åˆå§‹é‡‘é¢", value = formatNumber(initialGold)}
    }
})

-- åˆå§‹åŒ–å®Œæˆæç¤º
infoLabel.Text = string.format("ç›‘æ§ç³»ç»Ÿå·²å°±ç»ªï¼\nåˆå§‹é‡‘é¢ï¼š%s", formatNumber(initialGold))
